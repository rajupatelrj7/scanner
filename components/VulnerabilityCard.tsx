
import React, { useState } from 'react';
import { Vulnerability, Severity } from '../types';
import { SEVERITY_STYLES } from '../constants';

interface VulnerabilityCardProps {
  vulnerability: Vulnerability;
}

const SeverityBadge: React.FC<{ severity: Severity }> = ({ severity }) => {
  const style = SEVERITY_STYLES[severity];
  return (
    <span
      className={`px-3 py-1 text-xs font-semibold rounded-full ${style.bg} ${style.text} border ${style.border}`}
    >
      {severity.toUpperCase()}
    </span>
  );
};

const ChevronIcon: React.FC<{ expanded: boolean }> = ({ expanded }) => (
    <svg xmlns="http://www.w3.org/2000/svg" className={`h-5 w-5 transform transition-transform duration-300 ${expanded ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
    </svg>
);

export const VulnerabilityCard: React.FC<VulnerabilityCardProps> = ({ vulnerability }) => {
  const [isExpanded, setIsExpanded] = useState(false);
  const style = SEVERITY_STYLES[vulnerability.severity];

  return (
    <div className={`border-l-4 ${style.border} bg-gray-800/50 rounded-r-lg shadow-lg overflow-hidden`}>
        <button onClick={() => setIsExpanded(!isExpanded)} className="w-full text-left p-4 focus:outline-none focus:bg-gray-700/50 transition-colors duration-200">
            <div className="flex justify-between items-center">
                <div className="flex items-center space-x-4">
                    <SeverityBadge severity={vulnerability.severity} />
                    <h3 className="text-lg font-medium text-gray-200">{vulnerability.name}</h3>
                </div>
                <div className="flex items-center space-x-4">
                    <span className="text-sm text-gray-400 hidden sm:inline">{vulnerability.cwe}</span>
                    <ChevronIcon expanded={isExpanded} />
                </div>
            </div>
        </button>
        {isExpanded && (
            <div className="px-4 pb-4 pt-2 border-t border-gray-700/50">
                <div className="space-y-4">
                    <div>
                        <h4 className="font-semibold text-cyan-400 mb-1">Description</h4>
                        <p className="text-gray-300 text-sm leading-relaxed">{vulnerability.description}</p>
                    </div>
                    <div>
                        <h4 className="font-semibold text-cyan-400 mb-1">Remediation</h4>
                        <p className="text-gray-300 text-sm leading-relaxed">{vulnerability.remediation}</p>
                    </div>
                </div>
            </div>
        )}
    </div>
  );
};
